# DiachronicCorpus Notebook v1.1

这个版本继续在基础架构、功能方面和交互体验上进行了改进。

## 基础架构

* 为了后续添加更丰富的功能模块，为所有的运算结果添加了类型信息，目前的类型有：
  * List
    内容元素是dict的列表，可直接用于生成表格
  * ListWithChart
    在List的基础上，可以用于产生图标
  * String
    字符串类型，主要是错误信息
  * Boolean
    Bool型，主要是赋值语句的返回值
  * Wiki
    复合类型，由专用的block对其进行渲染和编辑

* 根据结果集的数据类型决定输出block的展示方式：
  * raw
    最直接的api输出，可以方便地复制粘贴，进行分享
  * prettify-json
    将raw输出以json格式prettify，为了调试看起来方便些
  * table
    基本的表格类型
  * chart
    目前只有柱状图，可以自定义横轴的字段名
  * example-table
    例句的表格，因为与基础的table差异较大，所以单独列出来了
  * wiki
    复合输出，针对Wiki类型的数据设计的，在output block中仅支持查看，编辑则需要修改cell类型

* 增加了cell类型的概念，使笔记本支持更多操作：
  * code
    代码类型，可以执行并得到结果集
  * markdown
    可以直接输入markdown语法的笔记
  * markdown-rendered
    由markdown类型的cell通过“执行”得到，展示渲染结果
  * editable-wiki
    为了确保notebook文件本身和kernel的上下文环境是相互独立的，对于一个通过code得到的wiki类型结果进行修改不可以直接在code的output block中进行。同时为了能够方便地进行编辑和上传下载修改的结果，我们用了一个新的cell类型对其进行包装，也就是editable-wiki。
    这种cell通过与两个变量连接，实现了从其中一个下载，在浏览器修改，并上传的一个新的变量的功能。

## 功能改进

### 增加的命令

* `examples(pattern, year, page_num, page_size)`
用于根据pattern和年份查找例句。为了避免一次返回过多数据，采用分页获取的语法。
* `synonyms(word)`
基于整个语料计算的词向量的k近邻，稍后会尝试修改成按年份计算的近义词。
* `wiki(word)`
返回一个wiki复合对象，已经加入的有近义词和例句，接下来要加入的是不同年份的pmi数据。

### 增加的功能

* 增加了一个菜单栏，目前包含保存、运行的快捷键和切换cell类型的选择器。
* 加入了对markdown的支持，可以通过输入markdown语法的笔记，渲染出相应的内容。
* 加入了名为`可编辑wiki`的cell类型，关于这个，我的考虑是这样的：
* 一开始我想可以直接把wiki命令的返回结果作为编辑的对象，但是这样的话会违背notebook中保存所有可展示信息；kernel中保存所有上下文以及运行信息的初衷。因为这样做会导致被修改的output中的内容无法通过input中的内容生成（因为加入了人工修改的操作）。
* 所以我想需要把wiki这个命令的返回值赋给一个变量，后续的操作在这个变量上进行。于是最基本的想法是把每一步操作都变成一个命令。但是这样会让使用者非常痛苦，因为他每一次增删改任何一个条目都要一个指令与之对应（比如`add_synonym(name=w, word=快跑)`）。
* 所以我想我需要的是一个与code不同的cell，它还要能读入一个变量，于是`editable-wiki`这个cell的雏形就出来了。这样每一次修改都可以保存在notebook中，而且不与code cell的原则相冲突。
* 接下来，既然能够保存在notebook上了，为了方便与后续操作衔接（比如备份、比较），不妨加入一个将这个结果赋给一个变量的功能，然后为了防止出现修改丢失的情况，顺便加入了自动上传的功能，于是就是现在这个样子了。

## 交互体验改进

* 由于`可编辑wiki`与其他类型的cell的运行机制有所不同，所以转换是不可逆的，因此在多处加入了提示框。
* 加入了output-block的折叠功能，分为隐藏（完全不显示）、折叠（最大高度300px）和展开（完全展示）
* 改进了选中的block外框的样式与颜色，现在与jupyter更一致了（主要是能更清晰地看出来是否处于编辑模式了）
* 因为同一个词可能会在同一个句子中多次出现，因此在wiki的例句模块采用了新的语句，不再与`example`共用一套逻辑，并进行了句子去重。
* 其他视觉引导与交互细节的修改。

## TODO List：

* 继承自上一次报告的部分
* 登录机制
* 垃圾回收机制
* 修改其他模块的视觉效果，比如词云
* 加入pmi命令及相关wiki条目
* 改进近义词的词向量，使用区分年份的向量

